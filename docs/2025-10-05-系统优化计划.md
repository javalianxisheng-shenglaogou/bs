# å¤šç«™ç‚¹CMSç³»ç»Ÿ - æ•´ä½“ä¼˜åŒ–è®¡åˆ’

**æ—¥æœŸ**: 2025-10-05  
**ä¼˜åŒ–äºº**: AI Assistant  
**ç›®æ ‡**: æå‡ç³»ç»Ÿå®‰å…¨æ€§ã€ç”¨æˆ·ä½“éªŒã€ä»£ç è´¨é‡å’Œæ€§èƒ½

---

## ğŸ“‹ ä¼˜åŒ–å†…å®¹æ¦‚è§ˆ

### 1. ğŸ”’ å®‰å…¨æ€§ä¼˜åŒ–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

#### 1.1 ç”¨æˆ·æƒé™æ£€æŸ¥å¢å¼º
**é—®é¢˜**: å½“å‰ç”¨æˆ·å¯ä»¥é€šè¿‡APIæ›´æ–°ä»»ä½•ç”¨æˆ·çš„ä¿¡æ¯
**ä¼˜åŒ–**: åœ¨Serviceå±‚æ·»åŠ æƒé™æ£€æŸ¥

#### 1.2 å¯†ç å®‰å…¨å¢å¼º
**é—®é¢˜**: å¯†ç ç­–ç•¥ä¸å¤Ÿä¸¥æ ¼
**ä¼˜åŒ–**: 
- æ·»åŠ å¯†ç å¼ºåº¦éªŒè¯
- æ·»åŠ å¯†ç ä¿®æ”¹åŠŸèƒ½
- æ·»åŠ å¯†ç é‡ç½®åŠŸèƒ½

#### 1.3 XSSé˜²æŠ¤
**é—®é¢˜**: å¯Œæ–‡æœ¬å†…å®¹å¯èƒ½å­˜åœ¨XSSé£é™©
**ä¼˜åŒ–**: æ·»åŠ HTMLå†…å®¹è¿‡æ»¤

#### 1.4 CSRFé˜²æŠ¤
**é—®é¢˜**: å½“å‰æœªå¯ç”¨CSRFé˜²æŠ¤
**ä¼˜åŒ–**: é…ç½®Spring Security CSRF

---

### 2. ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 2.1 åŠ è½½çŠ¶æ€ä¼˜åŒ–
**é—®é¢˜**: éƒ¨åˆ†é¡µé¢åŠ è½½æ—¶æ²¡æœ‰loadingæç¤º
**ä¼˜åŒ–**: ç»Ÿä¸€æ·»åŠ loadingçŠ¶æ€

#### 2.2 é”™è¯¯æç¤ºä¼˜åŒ–
**é—®é¢˜**: é”™è¯¯æç¤ºä¸å¤Ÿå‹å¥½
**ä¼˜åŒ–**: 
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- å‹å¥½çš„é”™è¯¯æç¤º
- é”™è¯¯æ—¥å¿—è®°å½•

#### 2.3 è¡¨å•éªŒè¯ä¼˜åŒ–
**é—®é¢˜**: è¡¨å•éªŒè¯ä¸å¤Ÿå®Œå–„
**ä¼˜åŒ–**: 
- æ·»åŠ å®æ—¶éªŒè¯
- ä¼˜åŒ–éªŒè¯æç¤º
- ç»Ÿä¸€éªŒè¯è§„åˆ™

#### 2.4 å“åº”å¼è®¾è®¡ä¼˜åŒ–
**é—®é¢˜**: éƒ¨åˆ†é¡µé¢åœ¨å°å±å¹•ä¸Šæ˜¾ç¤ºä¸ä½³
**ä¼˜åŒ–**: ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º

---

### 3. ğŸ’» ä»£ç è´¨é‡ä¼˜åŒ–

#### 3.1 ä»£ç é‡å¤æ¶ˆé™¤
**é—®é¢˜**: å­˜åœ¨é‡å¤ä»£ç 
**ä¼˜åŒ–**: æå–å…¬å…±ç»„ä»¶å’Œå·¥å…·å‡½æ•°

#### 3.2 ç±»å‹å®‰å…¨å¢å¼º
**é—®é¢˜**: éƒ¨åˆ†TypeScriptç±»å‹å®šä¹‰ä¸å®Œæ•´
**ä¼˜åŒ–**: å®Œå–„ç±»å‹å®šä¹‰

#### 3.3 æ³¨é‡Šå’Œæ–‡æ¡£
**é—®é¢˜**: éƒ¨åˆ†ä»£ç ç¼ºå°‘æ³¨é‡Š
**ä¼˜åŒ–**: æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£

---

### 4. âš¡ æ€§èƒ½ä¼˜åŒ–

#### 4.1 å‰ç«¯æ€§èƒ½ä¼˜åŒ–
- ç»„ä»¶æ‡’åŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½
- è¯·æ±‚é˜²æŠ–å’ŒèŠ‚æµ

#### 4.2 åç«¯æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- æ·»åŠ ç¼“å­˜
- åˆ†é¡µä¼˜åŒ–

---

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ1: å®‰å…¨æ€§ä¼˜åŒ–ï¼ˆç«‹å³æ‰§è¡Œï¼‰

#### 1.1 ç”¨æˆ·æƒé™æ£€æŸ¥
**æ–‡ä»¶**: `backend/src/main/java/com/cms/module/user/service/UserService.java`

```java
public UserDTO updateUser(Long id, UserUpdateRequest request) {
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·
    Long currentUserId = SecurityUtils.getCurrentUserId();
    boolean isAdmin = SecurityUtils.hasAuthority("user:update");
    
    // æ£€æŸ¥æƒé™ï¼šåªèƒ½æ›´æ–°è‡ªå·±çš„ä¿¡æ¯ï¼Œé™¤éæ˜¯ç®¡ç†å‘˜
    if (!currentUserId.equals(id) && !isAdmin) {
        throw new AccessDeniedException("æ‚¨åªèƒ½æ›´æ–°è‡ªå·±çš„ä¸ªäººä¿¡æ¯");
    }
    
    // ç»§ç»­æ›´æ–°é€»è¾‘...
}
```

#### 1.2 å¯†ç å¼ºåº¦éªŒè¯
**æ–‡ä»¶**: `backend/src/main/java/com/cms/common/util/PasswordValidator.java`

```java
public class PasswordValidator {
    public static boolean isStrongPassword(String password) {
        // è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
        String regex = "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$";
        return password.matches(regex);
    }
}
```

#### 1.3 XSSé˜²æŠ¤
**æ–‡ä»¶**: `backend/src/main/java/com/cms/common/util/HtmlSanitizer.java`

```java
public class HtmlSanitizer {
    public static String sanitize(String html) {
        // ä½¿ç”¨OWASP Java HTML Sanitizer
        PolicyFactory policy = Sanitizers.FORMATTING
            .and(Sanitizers.LINKS)
            .and(Sanitizers.IMAGES)
            .and(Sanitizers.BLOCKS);
        return policy.sanitize(html);
    }
}
```

---

### é˜¶æ®µ2: ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 2.1 ç»Ÿä¸€Loadingç»„ä»¶
**æ–‡ä»¶**: `frontend/src/components/Loading.vue`

```vue
<template>
  <div v-if="loading" class="loading-overlay">
    <el-icon class="is-loading"><Loading /></el-icon>
    <p>{{ text }}</p>
  </div>
</template>
```

#### 2.2 ç»Ÿä¸€é”™è¯¯å¤„ç†
**æ–‡ä»¶**: `frontend/src/utils/errorHandler.ts`

```typescript
export function handleError(error: any) {
  if (error.response) {
    const status = error.response.status
    const message = error.response.data?.message || 'è¯·æ±‚å¤±è´¥'
    
    switch (status) {
      case 401:
        ElMessage.error('æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ')
        router.push('/login')
        break
      case 403:
        ElMessage.error('æ²¡æœ‰æƒé™è®¿é—®')
        break
      case 404:
        ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
        break
      case 500:
        ElMessage.error('æœåŠ¡å™¨é”™è¯¯')
        break
      default:
        ElMessage.error(message)
    }
  } else {
    ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
  }
}
```

---

### é˜¶æ®µ3: ä»£ç è´¨é‡ä¼˜åŒ–

#### 3.1 æå–å…¬å…±APIå·¥å…·
**æ–‡ä»¶**: `frontend/src/utils/apiHelper.ts`

```typescript
export async function fetchList<T>(
  apiFunc: Function,
  params: any = {}
): Promise<T[]> {
  try {
    const response = await apiFunc(params)
    if (response.data?.data) {
      return Array.isArray(response.data.data) 
        ? response.data.data 
        : []
    }
    return []
  } catch (error) {
    handleError(error)
    return []
  }
}
```

#### 3.2 å®Œå–„TypeScriptç±»å‹
**æ–‡ä»¶**: `frontend/src/types/index.ts`

```typescript
export interface User {
  id: number
  username: string
  nickname: string
  email: string
  phone?: string
  avatar?: string
  status: 'ACTIVE' | 'INACTIVE'
  roles: Role[]
  createdAt: string
  updatedAt: string
}

export interface Content {
  id: number
  title: string
  content: string
  status: 'DRAFT' | 'PUBLISHED' | 'ARCHIVED'
  approvalStatus: 'NONE' | 'PENDING' | 'APPROVED' | 'REJECTED'
  siteId: number
  categoryId: number
  authorId: number
  createdAt: string
  updatedAt: string
}
```

---

### é˜¶æ®µ4: æ€§èƒ½ä¼˜åŒ–

#### 4.1 è·¯ç”±æ‡’åŠ è½½
**æ–‡ä»¶**: `frontend/src/router/index.ts`

```typescript
const routes = [
  {
    path: '/contents',
    component: () => import('@/views/Contents.vue')
  },
  {
    path: '/users',
    component: () => import('@/views/Users.vue')
  }
]
```

#### 4.2 è¯·æ±‚é˜²æŠ–
**æ–‡ä»¶**: `frontend/src/utils/debounce.ts`

```typescript
export function debounce<T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void {
  let timeout: NodeJS.Timeout | null = null
  
  return function(...args: Parameters<T>) {
    if (timeout) clearTimeout(timeout)
    timeout = setTimeout(() => func(...args), wait)
  }
}
```

---

## ğŸ“ ä¼˜åŒ–æ¸…å•

### å®‰å…¨æ€§ä¼˜åŒ–
- [ ] ç”¨æˆ·æƒé™æ£€æŸ¥ï¼ˆUserServiceï¼‰
- [ ] å¯†ç å¼ºåº¦éªŒè¯
- [ ] å¯†ç ä¿®æ”¹åŠŸèƒ½
- [ ] XSSé˜²æŠ¤
- [ ] CSRFé˜²æŠ¤é…ç½®

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] ç»Ÿä¸€Loadingç»„ä»¶
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] è¡¨å•éªŒè¯ä¼˜åŒ–
- [ ] å“åº”å¼è®¾è®¡ä¼˜åŒ–
- [ ] æ“ä½œç¡®è®¤å¯¹è¯æ¡†

### ä»£ç è´¨é‡ä¼˜åŒ–
- [ ] æå–å…¬å…±APIå·¥å…·
- [ ] å®Œå–„TypeScriptç±»å‹
- [ ] æ·»åŠ ä»£ç æ³¨é‡Š
- [ ] ç»Ÿä¸€ä»£ç é£æ ¼
- [ ] ç§»é™¤æœªä½¿ç”¨çš„ä»£ç 

### æ€§èƒ½ä¼˜åŒ–
- [ ] è·¯ç”±æ‡’åŠ è½½
- [ ] ç»„ä»¶æ‡’åŠ è½½
- [ ] è¯·æ±‚é˜²æŠ–/èŠ‚æµ
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

---

## ğŸ¯ æœ¬æ¬¡ä¼˜åŒ–é‡ç‚¹

### ç¬¬ä¸€æ‰¹ï¼šå®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. âœ… **ç”¨æˆ·æƒé™æ£€æŸ¥** - é˜²æ­¢ç”¨æˆ·ä¿®æ”¹ä»–äººä¿¡æ¯
2. âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - æå‡ç”¨æˆ·ä½“éªŒ
3. âœ… **LoadingçŠ¶æ€** - ä¼˜åŒ–åŠ è½½ä½“éªŒ
4. âœ… **è¡¨å•éªŒè¯** - æå‡æ•°æ®è´¨é‡

### ç¬¬äºŒæ‰¹ï¼šä»£ç è´¨é‡å’Œæ€§èƒ½ï¼ˆåç»­æ‰§è¡Œï¼‰

5. â³ **ä»£ç é‡æ„** - æå–å…¬å…±ç»„ä»¶
6. â³ **ç±»å‹å®Œå–„** - å¢å¼ºç±»å‹å®‰å…¨
7. â³ **æ€§èƒ½ä¼˜åŒ–** - æå‡å“åº”é€Ÿåº¦

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### å®‰å…¨æ€§æå‡
- âœ… é˜²æ­¢è¶Šæƒè®¿é—®
- âœ… å¢å¼ºå¯†ç å®‰å…¨
- âœ… é˜²æ­¢XSSæ”»å‡»

### ç”¨æˆ·ä½“éªŒæå‡
- âœ… æ›´å‹å¥½çš„é”™è¯¯æç¤º
- âœ… æ›´æµç•…çš„åŠ è½½ä½“éªŒ
- âœ… æ›´å®Œå–„çš„è¡¨å•éªŒè¯

### ä»£ç è´¨é‡æå‡
- âœ… æ›´å¥½çš„å¯ç»´æŠ¤æ€§
- âœ… æ›´å¼ºçš„ç±»å‹å®‰å…¨
- âœ… æ›´æ¸…æ™°çš„ä»£ç ç»“æ„

### æ€§èƒ½æå‡
- âœ… æ›´å¿«çš„é¡µé¢åŠ è½½
- âœ… æ›´å°‘çš„ç½‘ç»œè¯·æ±‚
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

**å¼€å§‹æ‰§è¡Œä¼˜åŒ–ï¼** ğŸš€

