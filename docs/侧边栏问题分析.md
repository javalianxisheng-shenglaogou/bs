# 侧边栏问题分析

## 📅 日期：2025-10-05

---

## 问题描述

用户反馈：每次刷新页面后，侧边栏会收起。

从用户提供的截图看：
- 侧边栏确实是展开的
- 显示了完整的菜单项（仪表盘、站点管理、内容管理等）
- 但用户说刷新后会收起

---

## 当前实现分析

### 1. 侧边栏代码

**位置**：`frontend/src/layouts/MainLayout.vue`

```vue
<el-aside width="220px" class="sidebar">
  <div class="logo">
    <el-icon :size="32" color="#409EFF" class="logo-icon">
      <OfficeBuilding />
    </el-icon>
    <h2 class="logo-text">多站点CMS</h2>
  </div>
  <el-scrollbar class="menu-scrollbar">
    <el-menu
      :default-active="activeMenu"
      router
      background-color="transparent"
      text-color="#bfcbd9"
      active-text-color="#409EFF"
      class="sidebar-menu"
    >
      <template v-for="route in menuRoutes" :key="route.path">
        <el-menu-item :index="route.path" class="menu-item">
          <el-icon class="menu-icon">
            <component :is="route.meta?.icon" />
          </el-icon>
          <span class="menu-title">{{ route.meta?.title }}</span>
        </el-menu-item>
      </template>
    </el-menu>
  </el-scrollbar>
</el-aside>
```

### 2. 当前特点

- ✅ 固定宽度：220px
- ❌ 没有折叠功能
- ❌ 没有状态管理
- ❌ 没有localStorage保存

---

## 可能的问题原因

### 原因1：浏览器窗口大小

- 用户可能在不同的窗口大小下使用
- 小窗口时，侧边栏可能被遮挡或隐藏
- 但这不是"收起"，而是"隐藏"

### 原因2：CSS样式问题

- 可能有CSS样式在某些情况下隐藏侧边栏
- 需要检查响应式样式

### 原因3：用户期望的"折叠"功能

- 用户可能期望有一个折叠按钮
- 点击后侧边栏收起，只显示图标
- 刷新后保持折叠状态

---

## 解决方案

### 方案A：添加侧边栏折叠功能（推荐）

#### 功能描述

1. 添加折叠按钮
2. 点击后侧边栏收起（只显示图标）
3. 再次点击展开
4. 使用localStorage保存折叠状态
5. 刷新后保持状态

#### 实现步骤

**1. 添加状态管理**

```typescript
// 从localStorage读取初始状态
const isCollapsed = ref(localStorage.getItem('sidebar-collapsed') === 'true')

// 监听状态变化，保存到localStorage
watch(isCollapsed, (val) => {
  localStorage.setItem('sidebar-collapsed', String(val))
})

// 切换折叠状态
const toggleCollapse = () => {
  isCollapsed.value = !isCollapsed.value
}
```

**2. 修改侧边栏宽度**

```vue
<el-aside :width="isCollapsed ? '64px' : '220px'" class="sidebar">
```

**3. 修改菜单**

```vue
<el-menu
  :default-active="activeMenu"
  :collapse="isCollapsed"
  router
  background-color="transparent"
  text-color="#bfcbd9"
  active-text-color="#409EFF"
  class="sidebar-menu"
>
```

**4. 添加折叠按钮**

```vue
<div class="collapse-button" @click="toggleCollapse">
  <el-icon>
    <Fold v-if="!isCollapsed" />
    <Expand v-else />
  </el-icon>
</div>
```

**5. 修改Logo显示**

```vue
<div class="logo">
  <el-icon :size="32" color="#409EFF" class="logo-icon">
    <OfficeBuilding />
  </el-icon>
  <h2 v-show="!isCollapsed" class="logo-text">多站点CMS</h2>
</div>
```

#### 完整代码示例

```vue
<template>
  <el-container class="main-layout">
    <!-- 侧边栏 -->
    <el-aside :width="isCollapsed ? '64px' : '220px'" class="sidebar">
      <div class="logo">
        <el-icon :size="32" color="#409EFF" class="logo-icon">
          <OfficeBuilding />
        </el-icon>
        <h2 v-show="!isCollapsed" class="logo-text">多站点CMS</h2>
      </div>
      
      <!-- 折叠按钮 -->
      <div class="collapse-button" @click="toggleCollapse">
        <el-icon>
          <Fold v-if="!isCollapsed" />
          <Expand v-else />
        </el-icon>
      </div>
      
      <el-scrollbar class="menu-scrollbar">
        <el-menu
          :default-active="activeMenu"
          :collapse="isCollapsed"
          router
          background-color="transparent"
          text-color="#bfcbd9"
          active-text-color="#409EFF"
          class="sidebar-menu"
        >
          <template v-for="route in menuRoutes" :key="route.path">
            <el-menu-item :index="route.path" class="menu-item">
              <el-icon class="menu-icon">
                <component :is="route.meta?.icon" />
              </el-icon>
              <span class="menu-title">{{ route.meta?.title }}</span>
            </el-menu-item>
          </template>
        </el-menu>
      </el-scrollbar>
    </el-aside>
    
    <!-- 其他内容保持不变 -->
  </el-container>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import { useUserStore } from '@/store/user'
import { 
  ArrowDown, 
  OfficeBuilding, 
  User, 
  SwitchButton,
  Fold,
  Expand
} from '@element-plus/icons-vue'
import { ElMessage } from 'element-plus'

const route = useRoute()
const router = useRouter()
const userStore = useUserStore()

// 侧边栏折叠状态
const isCollapsed = ref(localStorage.getItem('sidebar-collapsed') === 'true')

// 监听状态变化
watch(isCollapsed, (val) => {
  localStorage.setItem('sidebar-collapsed', String(val))
})

// 切换折叠状态
const toggleCollapse = () => {
  isCollapsed.value = !isCollapsed.value
}

// 其他代码保持不变...
</script>

<style scoped>
.collapse-button {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 40px;
  cursor: pointer;
  color: #bfcbd9;
  transition: all 0.3s;
}

.collapse-button:hover {
  color: #409EFF;
  background-color: rgba(64, 158, 255, 0.1);
}

.sidebar {
  transition: width 0.3s;
}

.logo {
  transition: all 0.3s;
}
</style>
```

---

### 方案B：检查CSS响应式问题

检查是否有CSS媒体查询导致侧边栏在某些屏幕尺寸下隐藏。

---

## 需要用户确认的信息

为了更好地解决问题，请用户提供：

1. **截图对比**：
   - 刷新前的截图
   - 刷新后的截图
   - 标注出具体的变化

2. **浏览器信息**：
   - 使用的浏览器（Chrome、Firefox、Edge等）
   - 浏览器版本
   - 窗口大小（全屏还是小窗口）

3. **控制台信息**：
   - 打开浏览器开发者工具（F12）
   - 查看Console是否有错误
   - 截图发送

4. **具体表现**：
   - 侧边栏是完全消失？
   - 还是只显示图标？
   - 还是被遮挡？

---

## 推荐行动

1. **立即实施**：方案A - 添加侧边栏折叠功能
   - 这是一个常见的功能需求
   - 可以提升用户体验
   - 解决状态保持问题

2. **等待确认**：用户提供更多信息后，再针对性修复

---

## 预估工作量

- 添加折叠功能：1-2小时
- 测试和优化：0.5-1小时
- **总计**：1.5-3小时

