# 分类管理完整功能说明

## 功能概述

分类管理是多站点CMS系统的核心功能之一,支持无限级分类、图标上传、SEO设置等完整功能。

## 核心功能

### 1. 树形结构管理

**特性:**
- 支持无限级分类
- 自动计算层级(level)
- 自动生成路径(path)
- 树形表格展示
- 支持展开/折叠

**数据结构:**
```typescript
interface Category {
  id?: number
  siteId: number
  parentId?: number
  name: string
  code: string
  description?: string
  iconUrl?: string
  coverUrl?: string
  sortOrder?: number
  level?: number
  path?: string
  isVisible?: boolean
  seoTitle?: string
  seoKeywords?: string
  seoDescription?: string
  children?: Category[]
}
```

### 2. 分类CRUD操作

#### 2.1 创建分类

**步骤:**
1. 选择站点
2. 点击"新增分类"按钮
3. 填写基本信息(名称、编码、描述等)
4. 上传图标和封面图(可选)
5. 设置SEO信息(可选)
6. 点击"确定"保存

**验证规则:**
- 站点: 必填
- 分类名称: 必填,最多100字符
- 分类编码: 必填,最多50字符,只能包含字母、数字和下划线

#### 2.2 编辑分类

**步骤:**
1. 点击分类行的"编辑"按钮
2. 修改需要更改的信息
3. 点击"确定"保存

**限制:**
- 不能修改站点
- 不能修改父分类

#### 2.3 删除分类

**步骤:**
1. 点击分类行的"删除"按钮
2. 确认删除操作

**注意:**
- 软删除,数据不会真正删除
- 删除父分类会同时删除所有子分类

#### 2.4 添加子分类

**步骤:**
1. 点击父分类行的"添加子分类"按钮
2. 系统自动设置父分类
3. 填写子分类信息
4. 点击"确定"保存

### 3. 可见性控制

**功能:**
- 支持显示/隐藏分类
- 一键切换可见性
- 隐藏的分类不会在前台显示

**操作:**
1. 点击分类行的"显示"或"隐藏"按钮
2. 系统自动更新可见性

### 4. 图标和封面图

#### 4.1 图标上传

**建议尺寸:** 64x64px

**支持格式:** JPG, PNG

**大小限制:** 2MB

**上传步骤:**
1. 切换到"图片设置"标签页
2. 点击图标上传区域
3. 选择图片文件
4. 等待上传完成

**删除图标:**
1. 点击"删除图标"按钮
2. 图标URL被清空

#### 4.2 封面图上传

**建议尺寸:** 800x450px (16:9比例)

**支持格式:** JPG, PNG

**大小限制:** 2MB

**上传步骤:**
1. 切换到"图片设置"标签页
2. 点击封面上传区域
3. 选择图片文件
4. 等待上传完成

**删除封面:**
1. 点击"删除封面"按钮
2. 封面URL被清空

### 5. SEO设置

#### 5.1 SEO标题

**说明:** 用于搜索引擎显示的标题

**限制:** 最多100字符

**默认值:** 如果不填,使用分类名称

#### 5.2 SEO关键词

**说明:** 用于搜索引擎优化的关键词

**限制:** 最多200字符

**格式:** 多个关键词用逗号分隔

**示例:** `技术,编程,Java,Python`

#### 5.3 SEO描述

**说明:** 用于搜索引擎显示的描述

**限制:** 最多300字符

**建议:** 简洁明了地描述分类内容

### 6. 排序功能

**说明:** 控制分类在列表中的显示顺序

**规则:** 数字越小越靠前

**范围:** 0-9999

**默认值:** 0

## API接口

### 6.1 获取分类树

**请求:**
```
GET /api/categories/tree?siteId={siteId}
```

**响应:**
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "siteId": 1,
      "name": "技术",
      "code": "tech",
      "level": 1,
      "sortOrder": 1,
      "isVisible": true,
      "children": [
        {
          "id": 2,
          "siteId": 1,
          "parentId": 1,
          "name": "Java",
          "code": "java",
          "level": 2,
          "sortOrder": 1,
          "isVisible": true
        }
      ]
    }
  ]
}
```

### 6.2 创建分类

**请求:**
```
POST /api/categories
Content-Type: application/json

{
  "siteId": 1,
  "parentId": null,
  "name": "新分类",
  "code": "new-category",
  "description": "分类描述",
  "iconUrl": "http://localhost:8080/api/files/categories/2025/10/04/xxx.png",
  "coverUrl": "http://localhost:8080/api/files/categories/2025/10/04/yyy.png",
  "sortOrder": 0,
  "isVisible": true,
  "seoTitle": "SEO标题",
  "seoKeywords": "关键词1,关键词2",
  "seoDescription": "SEO描述"
}
```

**响应:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 10,
    "siteId": 1,
    "name": "新分类",
    "code": "new-category",
    "level": 1,
    "path": "/10",
    "createdAt": "2025-10-04T10:30:00"
  }
}
```

### 6.3 更新分类

**请求:**
```
PUT /api/categories/{id}
Content-Type: application/json

{
  "name": "更新后的名称",
  "description": "更新后的描述"
}
```

### 6.4 删除分类

**请求:**
```
DELETE /api/categories/{id}
```

### 6.5 更新可见性

**请求:**
```
PUT /api/categories/{id}/visibility
Content-Type: application/json

{
  "isVisible": false
}
```

### 6.6 上传分类图片

**请求:**
```
POST /api/files/upload/category
Content-Type: multipart/form-data

file: [图片文件]
```

**响应:**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "filename": "xxx.png",
    "originalFilename": "icon.png",
    "url": "http://localhost:8080/api/files/categories/2025/10/04/xxx.png",
    "size": 12345,
    "contentType": "image/png",
    "path": "categories/2025/10/04/xxx.png"
  }
}
```

## 权限控制

### 权限列表

- `category:list`: 查看分类列表
- `category:view`: 查看分类详情
- `category:create`: 创建分类
- `category:update`: 更新分类
- `category:delete`: 删除分类

### 权限说明

**查看分类树:**
- 需要`category:list`权限

**创建分类:**
- 需要`category:create`权限
- 上传图片需要`category:create`或`category:update`权限

**编辑分类:**
- 需要`category:update`权限
- 上传图片需要`category:create`或`category:update`权限

**删除分类:**
- 需要`category:delete`权限

## 数据库设计

### categories表结构

```sql
CREATE TABLE categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    site_id BIGINT NOT NULL,
    parent_id BIGINT,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) NOT NULL,
    description TEXT,
    icon_url VARCHAR(500),
    cover_url VARCHAR(500),
    sort_order INT DEFAULT 0,
    level INT DEFAULT 1,
    path VARCHAR(500),
    is_visible BOOLEAN DEFAULT TRUE,
    seo_title VARCHAR(100),
    seo_keywords VARCHAR(200),
    seo_description VARCHAR(300),
    created_at DATETIME,
    updated_at DATETIME,
    created_by BIGINT,
    updated_by BIGINT,
    deleted BOOLEAN DEFAULT FALSE,
    version INT DEFAULT 0,
    UNIQUE KEY uk_site_code (site_id, code, deleted),
    INDEX idx_site_parent (site_id, parent_id),
    INDEX idx_visible (is_visible),
    FOREIGN KEY (site_id) REFERENCES sites(id)
);
```

## 使用示例

### 示例1: 创建技术分类

1. 选择站点: "我的博客"
2. 点击"新增分类"
3. 填写信息:
   - 分类名称: 技术
   - 分类编码: tech
   - 描述: 技术相关文章
   - 排序: 1
4. 上传图标: tech-icon.png
5. 设置SEO:
   - SEO标题: 技术文章 - 我的博客
   - SEO关键词: 技术,编程,开发
   - SEO描述: 分享技术文章和编程经验
6. 点击"确定"

### 示例2: 创建Java子分类

1. 找到"技术"分类
2. 点击"添加子分类"
3. 填写信息:
   - 分类名称: Java
   - 分类编码: java
   - 描述: Java编程相关
   - 排序: 1
4. 点击"确定"

## 总结

分类管理功能提供了完整的分类管理能力,包括:
- ✅ 无限级树形结构
- ✅ 完整的CRUD操作
- ✅ 图标和封面图上传
- ✅ SEO设置
- ✅ 可见性控制
- ✅ 排序功能
- ✅ 权限控制

通过这些功能,用户可以灵活地组织和管理网站内容分类。

