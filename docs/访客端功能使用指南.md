# 访客端功能使用指南

## 功能概述

访客端是一个面向普通用户的内容浏览系统，用户登录后可以：
- 浏览已发布的内容
- 按分类筛选内容
- 搜索感兴趣的文章
- 查看内容详情
- 切换不同站点

## 一、启动系统

### 1. 启动后端服务

```bash
cd backend
mvn spring-boot:run
```

后端会自动执行数据库迁移，创建访客角色和权限。

### 2. 启动前端服务

```bash
cd frontend
npm install
npm run dev
```

访问：http://localhost:3000

## 二、登录测试账号

系统提供了一个测试访客账号：

- **用户名**: `guest_user`
- **密码**: `password`
- **角色**: 访客（GUEST）

## 三、功能测试

### 3.1 访客端首页 (`/guest`)

登录后会自动跳转到访客端首页，包含：

1. **顶部导航栏**
   - Logo和站点名称
   - 站点选择器（可切换不同站点）
   - 搜索框
   - 用户信息和退出按钮

2. **左侧分类导航**
   - 树形结构展示分类
   - 显示每个分类的内容数量
   - 点击分类可筛选该分类下的内容

3. **右侧内容区域**
   - 置顶推荐：显示置顶内容（最多6条）
   - 精选内容：显示推荐内容（最多8条）
   - 最新发布：分页显示最新内容

### 3.2 搜索功能 (`/guest/search`)

1. 在顶部搜索框输入关键词
2. 按回车或点击搜索按钮
3. 系统会在标题和内容中进行全文搜索
4. 搜索结果中关键词会高亮显示
5. 支持分页浏览

### 3.3 内容详情页 (`/guest/content/:id`)

1. 点击任何内容卡片或列表项
2. 进入详情页，显示：
   - 面包屑导航
   - 完整文章内容
   - 作者、发布时间、浏览量等信息
   - 相关推荐（同分类的其他内容）
   - 返回和回到首页按钮

3. 每次查看详情，浏览量会自动+1

### 3.4 站点切换

1. 在顶部选择不同的站点
2. 系统会重新加载该站点的分类和内容
3. URL参数会自动更新

## 四、权限说明

访客角色（GUEST）拥有以下权限：

- `content:view:published` - 查看已发布内容列表
- `content:detail:published` - 查看已发布内容详情
- `content:search:published` - 搜索已发布内容
- `category:view:public` - 查看公开分类
- `site:view:public` - 查看活跃站点列表
- `content:increment:view` - 增加内容浏览量

**限制**：
- 只能看到状态为 `PUBLISHED` 的内容
- 无法访问管理后台功能
- 无法编辑、删除或创建内容

## 五、测试场景

### 场景1：浏览内容
1. 登录访客账号
2. 进入首页查看置顶和推荐内容
3. 点击分类筛选特定类型的内容
4. 点击内容查看详情

### 场景2：搜索内容
1. 在搜索框输入关键词（如"文章"、"新闻"等）
2. 查看搜索结果
3. 关键词会在标题和内容中高亮显示
4. 点击结果查看详情

### 场景3：切换站点
1. 在站点选择器中选择不同站点
2. 观察分类和内容的变化
3. 每个站点有独立的内容和分类

### 场景4：权限验证
1. 尝试访问管理后台路由（如 `/dashboard`）
2. 系统应该阻止访问或显示无权限提示
3. 只有非GUEST角色才能访问管理后台

## 六、数据准备

为了更好地测试，建议：

1. **创建测试站点**
   - 使用管理员账号（admin/password）登录
   - 创建几个不同的站点

2. **创建测试分类**
   - 为每个站点创建分类树
   - 设置分类为可见

3. **创建测试内容**
   - 创建不同状态的内容（草稿、已发布）
   - 设置封面图、摘要
   - 标记一些内容为置顶或推荐

4. **发布内容**
   - 将内容状态改为 PUBLISHED
   - 访客端只能看到已发布的内容

## 七、API端点

访客端使用的API端点：

```
GET /api/guest/contents/home?siteId={siteId}           # 首页数据
GET /api/guest/contents?siteId={siteId}&categoryId=... # 内容列表
GET /api/guest/contents/search?siteId={siteId}&keyword=... # 搜索
GET /api/guest/contents/{id}                           # 内容详情
GET /api/guest/contents/{id}/related?limit=5           # 相关内容
GET /api/guest/categories?siteId={siteId}              # 分类树
GET /api/guest/sites                                   # 活跃站点
```

所有端点都需要JWT认证。

## 八、常见问题

### Q1: 登录后看不到内容？
**A**: 确保数据库中有状态为 PUBLISHED 的内容。可以用管理员账号先创建并发布一些测试内容。

### Q2: 搜索没有结果？
**A**: 检查：
- 关键词是否存在于已发布内容的标题或正文中
- 站点是否有已发布的内容
- 数据库索引是否正确创建

### Q3: 切换站点没反应？
**A**: 检查浏览器控制台是否有错误。确保站点状态为 ACTIVE。

### Q4: 浏览量不增加？
**A**: 检查后端日志，确认 viewCount 字段更新成功。每次访问详情页都会 +1。

### Q5: 如何切换到管理后台？
**A**: 
- 访客账号无法访问管理后台
- 使用管理员账号登录后，在用户下拉菜单中选择"管理后台"
- 或直接访问 `/dashboard`

## 九、性能优化建议

1. **图片优化**
   - 使用懒加载（已实现）
   - 压缩封面图尺寸

2. **搜索优化**
   - 添加搜索防抖
   - 使用全文索引提升搜索速度

3. **缓存策略**
   - 首页数据可以缓存
   - 分类树可以缓存

4. **分页优化**
   - 调整每页显示数量
   - 使用虚拟滚动（大数据量时）

## 十、下一步扩展

可以考虑添加的功能：

1. 内容收藏/点赞
2. 评论系统
3. 用户个人主页
4. 阅读历史
5. 推荐算法
6. 社交分享
7. RSS订阅
8. 移动端适配优化

---

## 联系方式

如有问题，请查看：
- 技术文档：`docs/多站点CMS系统技术实现说明文档.txt`
- API文档：`文档/API接口文档.md`
- 问题报告：提交到项目Issue

