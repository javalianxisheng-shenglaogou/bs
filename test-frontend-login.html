<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯ç™»å½•æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status.online {
            background: #d4edda;
            color: #155724;
        }
        
        .status.offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        .links {
            margin-top: 30px;
            text-align: center;
        }
        
        .links a {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .links a:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª å‰ç«¯ç™»å½•æµ‹è¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h2>1. æ£€æŸ¥æœåŠ¡çŠ¶æ€</h2>
            <button onclick="checkServices()">æ£€æŸ¥å‰ç«¯å’Œåç«¯æœåŠ¡</button>
            <div id="serviceStatus"></div>
        </div>
        
        <div class="test-section">
            <h2>2. æµ‹è¯•åç«¯API</h2>
            <button onclick="testBackendLogin()">ç›´æ¥æµ‹è¯•åç«¯ç™»å½•API</button>
            <div id="backendResult"></div>
        </div>
        
        <div class="test-section">
            <h2>3. æµ‹è¯•å‰ç«¯ä»£ç†</h2>
            <button onclick="testFrontendProxy()">æµ‹è¯•å‰ç«¯ä»£ç†åˆ°åç«¯</button>
            <div id="proxyResult"></div>
        </div>
        
        <div class="test-section">
            <h2>4. æ¨¡æ‹Ÿå‰ç«¯ç™»å½•</h2>
            <button onclick="simulateFrontendLogin()">æ¨¡æ‹Ÿå‰ç«¯ç™»å½•æµç¨‹</button>
            <div id="loginResult"></div>
        </div>
        
        <div class="links">
            <a href="http://localhost:3000" target="_blank">æ‰“å¼€å‰ç«¯ç³»ç»Ÿ</a>
            <a href="http://localhost:8080/api/swagger-ui.html" target="_blank">æ‰“å¼€Swaggeræ–‡æ¡£</a>
        </div>
    </div>
    
    <script>
        async function checkServices() {
            const statusDiv = document.getElementById('serviceStatus');
            statusDiv.innerHTML = '<div class="result info">æ­£åœ¨æ£€æŸ¥æœåŠ¡...</div>';
            
            let result = '';
            
            // æ£€æŸ¥å‰ç«¯
            try {
                const frontendResponse = await fetch('http://localhost:3000');
                if (frontendResponse.ok) {
                    result += 'âœ… å‰ç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ (http://localhost:3000)\n';
                }
            } catch (error) {
                result += 'âŒ å‰ç«¯æœåŠ¡æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®\n';
            }
            
            // æ£€æŸ¥åç«¯
            try {
                const backendResponse = await fetch('http://localhost:8080/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'test', password: 'test' })
                });
                result += 'âœ… åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ (http://localhost:8080)\n';
            } catch (error) {
                result += 'âŒ åç«¯æœåŠ¡æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®\n';
            }
            
            statusDiv.innerHTML = `<div class="result success">${result}</div>`;
        }
        
        async function testBackendLogin() {
            const resultDiv = document.getElementById('backendResult');
            resultDiv.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•åç«¯API...</div>';
            
            try {
                const response = await fetch('http://localhost:8080/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password'
                    })
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    resultDiv.innerHTML = `<div class="result success">âœ… åç«¯ç™»å½•æˆåŠŸï¼\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">âŒ åç«¯ç™»å½•å¤±è´¥\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ è¯·æ±‚å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        async function testFrontendProxy() {
            const resultDiv = document.getElementById('proxyResult');
            resultDiv.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•å‰ç«¯ä»£ç†...</div>';
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password'
                    })
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    resultDiv.innerHTML = `<div class="result success">âœ… å‰ç«¯ä»£ç†å·¥ä½œæ­£å¸¸ï¼\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">âŒ ä»£ç†è¿”å›é”™è¯¯\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ä»£ç†è¯·æ±‚å¤±è´¥ï¼š${error.message}\n\nå¯èƒ½åŸå› ï¼š\n1. å‰ç«¯æœåŠ¡æœªè¿è¡Œ\n2. ä»£ç†é…ç½®é”™è¯¯\n3. åç«¯æœåŠ¡æœªè¿è¡Œ</div>`;
            }
        }
        
        async function simulateFrontendLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.innerHTML = '<div class="result info">æ­£åœ¨æ¨¡æ‹Ÿå‰ç«¯ç™»å½•...</div>';
            
            try {
                // æ¨¡æ‹Ÿå‰ç«¯çš„ç™»å½•æµç¨‹
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'password'
                    })
                });
                
                const data = await response.json();
                
                if (data.code === 200 && data.data) {
                    const token = data.data.token;
                    const userInfo = data.data.userInfo;
                    
                    // ä¿å­˜åˆ°localStorageï¼ˆæ¨¡æ‹Ÿå‰ç«¯è¡Œä¸ºï¼‰
                    localStorage.setItem('token', token);
                    localStorage.setItem('userInfo', JSON.stringify(userInfo));
                    
                    resultDiv.innerHTML = `<div class="result success">âœ… ç™»å½•æˆåŠŸï¼\n\nToken: ${token.substring(0, 50)}...\n\nç”¨æˆ·ä¿¡æ¯ï¼š\n${JSON.stringify(userInfo, null, 2)}\n\nâœ… Tokenå·²ä¿å­˜åˆ°localStorage\n\nç°åœ¨å¯ä»¥è®¿é—®ç³»ç»Ÿäº†ï¼</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">âŒ ç™»å½•å¤±è´¥\n\nå“åº”æ•°æ®ï¼š\n${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ç™»å½•è¯·æ±‚å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æœåŠ¡
        window.onload = function() {
            checkServices();
        };
    </script>
</body>
</html>

