# 毕业设计代码模板库

## 目录
1. [项目配置模板](#项目配置模板)
2. [实体类模板](#实体类模板)
3. [数据访问层模板](#数据访问层模板)
4. [服务层模板](#服务层模板)
5. [控制器模板](#控制器模板)
6. [前端组件模板](#前端组件模板)

---

## 项目配置模板

### 1.1 pom.xml 依赖配置
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.1.0</version>
        <relativePath/>
    </parent>
    
    <groupId>com.example</groupId>
    <artifactId>graduation-project</artifactId>
    <version>1.0.0</version>
    <name>graduation-project</name>
    <description>毕业设计项目</description>
    
    <properties>
        <java.version>17</java.version>
        <mysql.version>8.0.33</mysql.version>
        <jwt.version>0.11.5</jwt.version>
    </properties>
    
    <dependencies>
        <!-- Spring Boot Starters -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        
        <!-- Database -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>${mysql.version}</version>
        </dependency>
        
        <!-- Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        
        <!-- JWT -->
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>${jwt.version}</version>
        </dependency>
        
        <!-- Lombok -->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        
        <!-- Swagger -->
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>2.1.0</version>
        </dependency>
        
        <!-- Test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

### 1.2 application.yml 配置
```yaml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: graduation-project
    
  profiles:
    active: dev
    
  datasource:
    url: jdbc:mysql://localhost:3306/graduation_project?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: your_password
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        
  # 数据库连接池配置
  hikari:
    maximum-pool-size: 20
    minimum-idle: 5
    connection-timeout: 30000
    idle-timeout: 600000
    max-lifetime: 1800000
        
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    serialization:
      write-dates-as-timestamps: false
      
logging:
  level:
    com.example.graduation: DEBUG
    org.springframework.security: DEBUG
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/application.log
    max-size: 10MB
    max-history: 30

# JWT配置
jwt:
  secret: mySecretKey
  expiration: 86400000 # 24小时

# Swagger配置
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true
  packages-to-scan: com.example.graduation.controller
  paths-to-match: /api/**
```

---

## Swagger配置模板

### 1.1 Swagger配置类
```java
package com.example.graduation.config;

import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.info.Contact;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.info.License;
import io.swagger.v3.oas.models.security.SecurityRequirement;
import io.swagger.v3.oas.models.security.SecurityScheme;
import io.swagger.v3.oas.models.servers.Server;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;

@Configuration
public class SwaggerConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("基于Spring Boot的多站点内容管理系统API")
                        .description("多站点CMS系统的RESTful API文档")
                        .version("1.0.0")
                        .contact(new Contact()
                                .name("姚奇奇")
                                .email("your-email@example.com")
                                .url("https://github.com/your-username"))
                        .license(new License()
                                .name("MIT License")
                                .url("https://opensource.org/licenses/MIT")))
                .servers(List.of(
                        new Server().url("http://localhost:8080").description("开发环境"),
                        new Server().url("https://api.example.com").description("生产环境")))
                .addSecurityItem(new SecurityRequirement().addList("Bearer Authentication"))
                .components(new io.swagger.v3.oas.models.Components()
                        .addSecuritySchemes("Bearer Authentication",
                                new SecurityScheme()
                                        .type(SecurityScheme.Type.HTTP)
                                        .scheme("bearer")
                                        .bearerFormat("JWT")
                                        .description("请输入JWT token，格式：Bearer {token}")));
    }
}
```

### 1.2 Swagger注解使用示例
```java
@RestController
@RequestMapping("/api/v1/users")
@Tag(name = "用户管理", description = "用户相关的API接口")
public class UserController {

    @Operation(
        summary = "创建用户",
        description = "创建新的用户账户",
        responses = {
            @ApiResponse(responseCode = "201", description = "用户创建成功"),
            @ApiResponse(responseCode = "400", description = "请求参数错误"),
            @ApiResponse(responseCode = "409", description = "用户名或邮箱已存在")
        }
    )
    @PostMapping
    public ResponseEntity<ApiResponse<UserResponseDTO>> createUser(
            @Parameter(description = "用户创建信息", required = true)
            @Valid @RequestBody UserCreateDTO createDTO) {
        // 实现逻辑
    }

    @Operation(summary = "获取用户列表", description = "分页获取用户列表")
    @GetMapping
    public ResponseEntity<ApiResponse<PageResult<UserResponseDTO>>> getUsers(
            @Parameter(description = "页码，从1开始") @RequestParam(defaultValue = "1") int page,
            @Parameter(description = "每页大小") @RequestParam(defaultValue = "10") int size,
            @Parameter(description = "搜索关键字") @RequestParam(required = false) String keyword) {
        // 实现逻辑
    }
}
```

---

## 实体类模板

### 2.1 基础实体类
```java
package com.example.graduation.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.experimental.SuperBuilder;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import java.time.LocalDateTime;

@MappedSuperclass
@Data
@NoArgsConstructor
@AllArgsConstructor
@SuperBuilder
public abstract class BaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;
    
    @Column(name = "created_by")
    private String createdBy;
    
    @Column(name = "updated_by")
    private String updatedBy;
    
    @Column(name = "deleted", nullable = false)
    private Boolean deleted = false;
}
```

### 2.2 用户实体类
```java
package com.example.graduation.entity;

import jakarta.persistence.*;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.NoArgsConstructor;
import lombok.experimental.SuperBuilder;

@Entity
@Table(name = "users", indexes = {
    @Index(name = "idx_username", columnList = "username"),
    @Index(name = "idx_email", columnList = "email"),
    @Index(name = "idx_status", columnList = "status")
})
@Data
@EqualsAndHashCode(callSuper = true)
@NoArgsConstructor
@AllArgsConstructor
@SuperBuilder
public class User extends BaseEntity {
    
    @NotBlank(message = "用户名不能为空")
    @Size(min = 3, max = 50, message = "用户名长度必须在3-50之间")
    @Column(nullable = false, unique = true, length = 50)
    private String username;
    
    @Email(message = "邮箱格式不正确")
    @NotBlank(message = "邮箱不能为空")
    @Column(nullable = false, unique = true, length = 100)
    private String email;
    
    @NotBlank(message = "密码不能为空")
    @Column(name = "password_hash", nullable = false)
    private String passwordHash;
    
    @Column(length = 50)
    private String nickname;
    
    @Column(name = "avatar_url")
    private String avatarUrl;
    
    @Column(length = 20)
    private String phone;
    
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private UserRole role = UserRole.USER;
    
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private UserStatus status = UserStatus.ACTIVE;
    
    @Column(name = "last_login_at")
    private LocalDateTime lastLoginAt;
    
    public enum UserRole {
        ADMIN("管理员"),
        USER("普通用户");
        
        private final String description;
        
        UserRole(String description) {
            this.description = description;
        }
        
        public String getDescription() {
            return description;
        }
    }
    
    public enum UserStatus {
        ACTIVE("正常"),
        INACTIVE("禁用"),
        LOCKED("锁定");
        
        private final String description;
        
        UserStatus(String description) {
            this.description = description;
        }
        
        public String getDescription() {
            return description;
        }
    }
}
```

---

## 数据访问层模板

### 3.1 基础Repository接口
```java
package com.example.graduation.repository;

import com.example.graduation.entity.BaseEntity;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.NoRepositoryBean;
import org.springframework.data.repository.query.Param;

import java.util.List;
import java.util.Optional;

@NoRepositoryBean
public interface BaseRepository<T extends BaseEntity, ID> extends JpaRepository<T, ID> {
    
    /**
     * 查找未删除的实体
     */
    @Query("SELECT e FROM #{#entityName} e WHERE e.deleted = false")
    List<T> findAllActive();
    
    /**
     * 分页查找未删除的实体
     */
    @Query("SELECT e FROM #{#entityName} e WHERE e.deleted = false")
    Page<T> findAllActive(Pageable pageable);
    
    /**
     * 根据ID查找未删除的实体
     */
    @Query("SELECT e FROM #{#entityName} e WHERE e.id = :id AND e.deleted = false")
    Optional<T> findActiveById(@Param("id") ID id);
    
    /**
     * 软删除
     */
    @Modifying
    @Query("UPDATE #{#entityName} e SET e.deleted = true WHERE e.id = :id")
    void softDeleteById(@Param("id") ID id);
}
```

### 3.2 用户Repository
```java
package com.example.graduation.repository;

import com.example.graduation.entity.User;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface UserRepository extends BaseRepository<User, Long> {
    
    /**
     * 根据用户名查找用户
     */
    @Query("SELECT u FROM User u WHERE u.username = :username AND u.deleted = false")
    Optional<User> findByUsername(@Param("username") String username);
    
    /**
     * 根据邮箱查找用户
     */
    @Query("SELECT u FROM User u WHERE u.email = :email AND u.deleted = false")
    Optional<User> findByEmail(@Param("email") String email);
    
    /**
     * 检查用户名是否存在
     */
    @Query("SELECT COUNT(u) > 0 FROM User u WHERE u.username = :username AND u.deleted = false")
    boolean existsByUsername(@Param("username") String username);
    
    /**
     * 检查邮箱是否存在
     */
    @Query("SELECT COUNT(u) > 0 FROM User u WHERE u.email = :email AND u.deleted = false")
    boolean existsByEmail(@Param("email") String email);
    
    /**
     * 根据角色查找用户
     */
    @Query("SELECT u FROM User u WHERE u.role = :role AND u.deleted = false")
    Page<User> findByRole(@Param("role") User.UserRole role, Pageable pageable);
    
    /**
     * 根据状态查找用户
     */
    @Query("SELECT u FROM User u WHERE u.status = :status AND u.deleted = false")
    Page<User> findByStatus(@Param("status") User.UserStatus status, Pageable pageable);
    
    /**
     * 模糊查询用户
     */
    @Query("SELECT u FROM User u WHERE " +
           "(u.username LIKE %:keyword% OR u.email LIKE %:keyword% OR u.nickname LIKE %:keyword%) " +
           "AND u.deleted = false")
    Page<User> findByKeyword(@Param("keyword") String keyword, Pageable pageable);
}
```

---

## 服务层模板

### 4.1 基础Service接口
```java
package com.example.graduation.service;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

import java.util.List;
import java.util.Optional;

public interface BaseService<T, ID> {
    
    /**
     * 保存实体
     */
    T save(T entity);
    
    /**
     * 根据ID查找实体
     */
    Optional<T> findById(ID id);
    
    /**
     * 查找所有实体
     */
    List<T> findAll();
    
    /**
     * 分页查找实体
     */
    Page<T> findAll(Pageable pageable);
    
    /**
     * 更新实体
     */
    T update(T entity);
    
    /**
     * 根据ID删除实体
     */
    void deleteById(ID id);
    
    /**
     * 检查实体是否存在
     */
    boolean existsById(ID id);
}
```

### 4.2 用户Service接口
```java
package com.example.graduation.service;

import com.example.graduation.dto.UserCreateDTO;
import com.example.graduation.dto.UserUpdateDTO;
import com.example.graduation.entity.User;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

import java.util.Optional;

public interface UserService extends BaseService<User, Long> {
    
    /**
     * 创建用户
     */
    User createUser(UserCreateDTO createDTO);
    
    /**
     * 更新用户
     */
    User updateUser(Long id, UserUpdateDTO updateDTO);
    
    /**
     * 根据用户名查找用户
     */
    Optional<User> findByUsername(String username);
    
    /**
     * 根据邮箱查找用户
     */
    Optional<User> findByEmail(String email);
    
    /**
     * 检查用户名是否存在
     */
    boolean existsByUsername(String username);
    
    /**
     * 检查邮箱是否存在
     */
    boolean existsByEmail(String email);
    
    /**
     * 修改密码
     */
    void changePassword(Long userId, String oldPassword, String newPassword);
    
    /**
     * 重置密码
     */
    void resetPassword(Long userId, String newPassword);
    
    /**
     * 启用/禁用用户
     */
    void toggleUserStatus(Long userId);
    
    /**
     * 关键字搜索用户
     */
    Page<User> searchUsers(String keyword, Pageable pageable);
}
```

### 4.3 用户Service实现类
```java
package com.example.graduation.service.impl;

import com.example.graduation.dto.UserCreateDTO;
import com.example.graduation.dto.UserUpdateDTO;
import com.example.graduation.entity.User;
import com.example.graduation.exception.BusinessException;
import com.example.graduation.repository.UserRepository;
import com.example.graduation.service.UserService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;

@Service
@RequiredArgsConstructor
@Slf4j
@Transactional(readOnly = true)
public class UserServiceImpl implements UserService {
    
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    
    @Override
    @Transactional
    public User createUser(UserCreateDTO createDTO) {
        log.info("创建用户: {}", createDTO.getUsername());
        
        // 检查用户名是否已存在
        if (userRepository.existsByUsername(createDTO.getUsername())) {
            throw new BusinessException("用户名已存在");
        }
        
        // 检查邮箱是否已存在
        if (userRepository.existsByEmail(createDTO.getEmail())) {
            throw new BusinessException("邮箱已存在");
        }
        
        // 创建用户
        User user = User.builder()
                .username(createDTO.getUsername())
                .email(createDTO.getEmail())
                .passwordHash(passwordEncoder.encode(createDTO.getPassword()))
                .nickname(createDTO.getNickname())
                .role(User.UserRole.USER)
                .status(User.UserStatus.ACTIVE)
                .build();
        
        return userRepository.save(user);
    }
    
    @Override
    @Transactional
    public User updateUser(Long id, UserUpdateDTO updateDTO) {
        log.info("更新用户: {}", id);
        
        User user = userRepository.findActiveById(id)
                .orElseThrow(() -> new BusinessException("用户不存在"));
        
        // 更新用户信息
        if (StringUtils.hasText(updateDTO.getNickname())) {
            user.setNickname(updateDTO.getNickname());
        }
        
        if (StringUtils.hasText(updateDTO.getPhone())) {
            user.setPhone(updateDTO.getPhone());
        }
        
        if (StringUtils.hasText(updateDTO.getAvatarUrl())) {
            user.setAvatarUrl(updateDTO.getAvatarUrl());
        }
        
        return userRepository.save(user);
    }
    
    @Override
    public Optional<User> findById(Long id) {
        return userRepository.findActiveById(id);
    }
    
    @Override
    public Optional<User> findByUsername(String username) {
        return userRepository.findByUsername(username);
    }
    
    @Override
    public Optional<User> findByEmail(String email) {
        return userRepository.findByEmail(email);
    }
    
    @Override
    public boolean existsByUsername(String username) {
        return userRepository.existsByUsername(username);
    }
    
    @Override
    public boolean existsByEmail(String email) {
        return userRepository.existsByEmail(email);
    }
    
    @Override
    @Transactional
    public void changePassword(Long userId, String oldPassword, String newPassword) {
        log.info("修改用户密码: {}", userId);
        
        User user = userRepository.findActiveById(userId)
                .orElseThrow(() -> new BusinessException("用户不存在"));
        
        // 验证旧密码
        if (!passwordEncoder.matches(oldPassword, user.getPasswordHash())) {
            throw new BusinessException("原密码错误");
        }
        
        // 更新密码
        user.setPasswordHash(passwordEncoder.encode(newPassword));
        userRepository.save(user);
    }
    
    @Override
    @Transactional
    public void resetPassword(Long userId, String newPassword) {
        log.info("重置用户密码: {}", userId);
        
        User user = userRepository.findActiveById(userId)
                .orElseThrow(() -> new BusinessException("用户不存在"));
        
        user.setPasswordHash(passwordEncoder.encode(newPassword));
        userRepository.save(user);
    }
    
    @Override
    @Transactional
    public void toggleUserStatus(Long userId) {
        log.info("切换用户状态: {}", userId);
        
        User user = userRepository.findActiveById(userId)
                .orElseThrow(() -> new BusinessException("用户不存在"));
        
        user.setStatus(user.getStatus() == User.UserStatus.ACTIVE ? 
                      User.UserStatus.INACTIVE : User.UserStatus.ACTIVE);
        userRepository.save(user);
    }
    
    @Override
    public Page<User> searchUsers(String keyword, Pageable pageable) {
        return userRepository.findByKeyword(keyword, pageable);
    }
    
    // 实现BaseService的其他方法
    @Override
    @Transactional
    public User save(User entity) {
        return userRepository.save(entity);
    }
    
    @Override
    public List<User> findAll() {
        return userRepository.findAllActive();
    }
    
    @Override
    public Page<User> findAll(Pageable pageable) {
        return userRepository.findAllActive(pageable);
    }
    
    @Override
    @Transactional
    public User update(User entity) {
        return userRepository.save(entity);
    }
    
    @Override
    @Transactional
    public void deleteById(Long id) {
        userRepository.softDeleteById(id);
    }
    
    @Override
    public boolean existsById(Long id) {
        return userRepository.findActiveById(id).isPresent();
    }
}
```

---

## 控制器模板

### 5.1 基础Controller
```java
package com.example.graduation.controller;

import com.example.graduation.common.ApiResponse;
import com.example.graduation.common.PageResult;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RequestParam;

public abstract class BaseController {
    
    /**
     * 创建分页对象
     */
    protected Pageable createPageable(int page, int size, String sort, String direction) {
        Sort.Direction sortDirection = "desc".equalsIgnoreCase(direction) ? 
                                      Sort.Direction.DESC : Sort.Direction.ASC;
        Sort sortBy = Sort.by(sortDirection, sort);
        return PageRequest.of(page - 1, size, sortBy); // page从1开始
    }
    
    /**
     * 构建成功响应
     */
    protected <T> ResponseEntity<ApiResponse<T>> success(T data) {
        return ResponseEntity.ok(ApiResponse.success(data));
    }
    
    /**
     * 构建成功响应（带消息）
     */
    protected <T> ResponseEntity<ApiResponse<T>> success(String message, T data) {
        return ResponseEntity.ok(ApiResponse.success(message, data));
    }
    
    /**
     * 构建分页响应
     */
    protected <T> ResponseEntity<ApiResponse<PageResult<T>>> successPage(Page<T> page) {
        PageResult<T> pageResult = PageResult.of(page);
        return ResponseEntity.ok(ApiResponse.success(pageResult));
    }
}
```

### 5.2 用户Controller
```java
package com.example.graduation.controller;

import com.example.graduation.common.ApiResponse;
import com.example.graduation.common.PageResult;
import com.example.graduation.dto.UserCreateDTO;
import com.example.graduation.dto.UserResponseDTO;
import com.example.graduation.dto.UserUpdateDTO;
import com.example.graduation.entity.User;
import com.example.graduation.service.UserService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/v1/users")
@RequiredArgsConstructor
@Slf4j
@Tag(name = "用户管理", description = "用户相关API")
public class UserController extends BaseController {
    
    private final UserService userService;
    
    @Operation(summary = "创建用户", description = "创建新的用户账户")
    @PostMapping
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<ApiResponse<UserResponseDTO>> createUser(
            @Valid @RequestBody UserCreateDTO createDTO) {
        log.info("创建用户请求: {}", createDTO.getUsername());
        
        User user = userService.createUser(createDTO);
        UserResponseDTO responseDTO = UserResponseDTO.from(user);
        
        return ResponseEntity.status(HttpStatus.CREATED)
                .body(ApiResponse.success("用户创建成功", responseDTO));
    }
    
    @Operation(summary = "获取用户详情", description = "根据用户ID获取用户详细信息")
    @GetMapping("/{id}")
    public ResponseEntity<ApiResponse<UserResponseDTO>> getUser(
            @Parameter(description = "用户ID") @PathVariable Long id) {
        log.info("获取用户详情: {}", id);
        
        User user = userService.findById(id)
                .orElseThrow(() -> new BusinessException("用户不存在"));
        UserResponseDTO responseDTO = UserResponseDTO.from(user);
        
        return success(responseDTO);
    }
    
    @Operation(summary = "获取用户列表", description = "分页获取用户列表")
    @GetMapping
    public ResponseEntity<ApiResponse<PageResult<UserResponseDTO>>> getUsers(
            @Parameter(description = "页码") @RequestParam(defaultValue = "1") int page,
            @Parameter(description = "每页大小") @RequestParam(defaultValue = "10") int size,
            @Parameter(description = "排序字段") @RequestParam(defaultValue = "createdAt") String sort,
            @Parameter(description = "排序方向") @RequestParam(defaultValue = "desc") String direction,
            @Parameter(description = "搜索关键字") @RequestParam(required = false) String keyword) {
        
        log.info("获取用户列表: page={}, size={}, keyword={}", page, size, keyword);
        
        Pageable pageable = createPageable(page, size, sort, direction);
        Page<User> userPage;
        
        if (keyword != null && !keyword.trim().isEmpty()) {
            userPage = userService.searchUsers(keyword.trim(), pageable);
        } else {
            userPage = userService.findAll(pageable);
        }
        
        Page<UserResponseDTO> responsePage = userPage.map(UserResponseDTO::from);
        return successPage(responsePage);
    }
    
    @Operation(summary = "更新用户", description = "更新用户信息")
    @PutMapping("/{id}")
    public ResponseEntity<ApiResponse<UserResponseDTO>> updateUser(
            @Parameter(description = "用户ID") @PathVariable Long id,
            @Valid @RequestBody UserUpdateDTO updateDTO) {
        log.info("更新用户: {}", id);
        
        User user = userService.updateUser(id, updateDTO);
        UserResponseDTO responseDTO = UserResponseDTO.from(user);
        
        return success("用户更新成功", responseDTO);
    }
    
    @Operation(summary = "删除用户", description = "软删除用户")
    @DeleteMapping("/{id}")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<ApiResponse<Void>> deleteUser(
            @Parameter(description = "用户ID") @PathVariable Long id) {
        log.info("删除用户: {}", id);
        
        userService.deleteById(id);
        
        return success("用户删除成功", null);
    }
    
    @Operation(summary = "切换用户状态", description = "启用或禁用用户")
    @PatchMapping("/{id}/toggle-status")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<ApiResponse<Void>> toggleUserStatus(
            @Parameter(description = "用户ID") @PathVariable Long id) {
        log.info("切换用户状态: {}", id);
        
        userService.toggleUserStatus(id);
        
        return success("用户状态切换成功", null);
    }
}
```

---

## 前端组件模板

### 6.1 Vue.js 用户列表组件
```vue
<template>
  <div class="user-list">
    <!-- 搜索栏 -->
    <div class="search-bar">
      <el-input
        v-model="searchKeyword"
        placeholder="搜索用户名、邮箱或昵称"
        clearable
        @keyup.enter="handleSearch"
        style="width: 300px; margin-right: 10px;"
      >
        <template #prefix>
          <el-icon><Search /></el-icon>
        </template>
      </el-input>
      <el-button type="primary" @click="handleSearch">搜索</el-button>
      <el-button @click="handleReset">重置</el-button>
      <el-button type="success" @click="handleCreate">新增用户</el-button>
    </div>

    <!-- 用户表格 -->
    <el-table
      :data="userList"
      v-loading="loading"
      stripe
      style="width: 100%; margin-top: 20px;"
    >
      <el-table-column prop="id" label="ID" width="80" />
      <el-table-column prop="username" label="用户名" width="120" />
      <el-table-column prop="email" label="邮箱" width="200" />
      <el-table-column prop="nickname" label="昵称" width="120" />
      <el-table-column prop="role" label="角色" width="100">
        <template #default="{ row }">
          <el-tag :type="row.role === 'ADMIN' ? 'danger' : 'primary'">
            {{ row.role === 'ADMIN' ? '管理员' : '普通用户' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="status" label="状态" width="100">
        <template #default="{ row }">
          <el-tag :type="row.status === 'ACTIVE' ? 'success' : 'danger'">
            {{ row.status === 'ACTIVE' ? '正常' : '禁用' }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="createdAt" label="创建时间" width="180">
        <template #default="{ row }">
          {{ formatDate(row.createdAt) }}
        </template>
      </el-table-column>
      <el-table-column label="操作" width="200" fixed="right">
        <template #default="{ row }">
          <el-button size="small" @click="handleEdit(row)">编辑</el-button>
          <el-button 
            size="small" 
            :type="row.status === 'ACTIVE' ? 'warning' : 'success'"
            @click="handleToggleStatus(row)"
          >
            {{ row.status === 'ACTIVE' ? '禁用' : '启用' }}
          </el-button>
          <el-button size="small" type="danger" @click="handleDelete(row)">删除</el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页 -->
    <el-pagination
      v-model:current-page="pagination.page"
      v-model:page-size="pagination.size"
      :page-sizes="[10, 20, 50, 100]"
      :total="pagination.total"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handlePageChange"
      style="margin-top: 20px; text-align: right;"
    />

    <!-- 用户表单对话框 -->
    <UserForm
      v-model:visible="formVisible"
      :user="currentUser"
      :mode="formMode"
      @success="handleFormSuccess"
    />
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Search } from '@element-plus/icons-vue'
import UserForm from './UserForm.vue'
import { userApi } from '@/api/user'
import { formatDate } from '@/utils/date'

// 响应式数据
const loading = ref(false)
const userList = ref([])
const searchKeyword = ref('')
const formVisible = ref(false)
const formMode = ref('create') // create | edit
const currentUser = ref(null)

const pagination = reactive({
  page: 1,
  size: 10,
  total: 0
})

// 获取用户列表
const fetchUsers = async () => {
  loading.value = true
  try {
    const params = {
      page: pagination.page,
      size: pagination.size,
      keyword: searchKeyword.value
    }
    
    const response = await userApi.getUsers(params)
    userList.value = response.data.data.records
    pagination.total = response.data.data.total
  } catch (error) {
    ElMessage.error('获取用户列表失败')
  } finally {
    loading.value = false
  }
}

// 搜索
const handleSearch = () => {
  pagination.page = 1
  fetchUsers()
}

// 重置
const handleReset = () => {
  searchKeyword.value = ''
  pagination.page = 1
  fetchUsers()
}

// 新增用户
const handleCreate = () => {
  currentUser.value = null
  formMode.value = 'create'
  formVisible.value = true
}

// 编辑用户
const handleEdit = (user) => {
  currentUser.value = { ...user }
  formMode.value = 'edit'
  formVisible.value = true
}

// 切换用户状态
const handleToggleStatus = async (user) => {
  try {
    await userApi.toggleUserStatus(user.id)
    ElMessage.success('用户状态切换成功')
    fetchUsers()
  } catch (error) {
    ElMessage.error('用户状态切换失败')
  }
}

// 删除用户
const handleDelete = async (user) => {
  try {
    await ElMessageBox.confirm(
      `确定要删除用户 "${user.username}" 吗？`,
      '确认删除',
      {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }
    )
    
    await userApi.deleteUser(user.id)
    ElMessage.success('用户删除成功')
    fetchUsers()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('用户删除失败')
    }
  }
}

// 分页大小改变
const handleSizeChange = (size) => {
  pagination.size = size
  pagination.page = 1
  fetchUsers()
}

// 页码改变
const handlePageChange = (page) => {
  pagination.page = page
  fetchUsers()
}

// 表单提交成功
const handleFormSuccess = () => {
  formVisible.value = false
  fetchUsers()
}

// 组件挂载时获取数据
onMounted(() => {
  fetchUsers()
})
</script>

<style scoped>
.user-list {
  padding: 20px;
}

.search-bar {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}
</style>
```

这份代码模板库为您提供了完整的项目开发模板，包括：

1. **项目配置**：Maven依赖和Spring Boot配置
2. **实体类**：基础实体类和用户实体类模板
3. **数据访问层**：Repository接口模板
4. **服务层**：Service接口和实现类模板
5. **控制器**：RESTful API控制器模板
6. **前端组件**：Vue.js组件模板

您可以根据具体的项目需求，复制这些模板并进行相应的修改。这些模板遵循了最佳实践，包括：

- 统一的代码风格和命名规范
- 完善的异常处理
- 缓存支持
- 安全认证
- API文档注解
- 前端组件化开发

使用这些模板可以大大提高您的开发效率，确保代码质量和一致性。
