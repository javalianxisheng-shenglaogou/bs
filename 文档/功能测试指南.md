# 多站点CMS系统 - 功能测试指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 编写日期 | 2025-10-03 |
| 系统版本 | v0.3.0 |

---

## 目录

1. [环境准备](#1-环境准备)
2. [用户认证测试](#2-用户认证测试)
3. [用户管理测试](#3-用户管理测试)
4. [API测试](#4-api测试)
5. [常见问题](#5-常见问题)

---

## 1. 环境准备

### 1.1 确认服务状态

**后端服务：**
```bash
# 访问健康检查接口
curl http://localhost:8080/api/test/health
```

预期响应：
```json
{
  "code": 200,
  "message": "success",
  "data": "CMS API is running!",
  "timestamp": "2025-10-03T00:00:00"
}
```

**前端服务：**
- 访问：http://localhost:3000
- 应该自动跳转到登录页面

**Swagger文档：**
- 访问：http://localhost:8080/api/swagger-ui.html

### 1.2 测试账号

| 用户名 | 密码 | 角色 | 权限 |
|--------|------|------|------|
| admin | password | SUPER_ADMIN | 所有权限 |
| siteadmin | password | SITE_ADMIN | 站点管理权限 |
| editor1 | password | EDITOR | 内容编辑权限 |

---

## 2. 用户认证测试

### 2.1 登录功能测试

**测试步骤：**
1. 访问 http://localhost:3000
2. 输入用户名：`admin`
3. 输入密码：`password`
4. 点击"登录"按钮

**预期结果：**
- ✅ 显示"登录成功"提示
- ✅ 自动跳转到仪表盘页面
- ✅ 右上角显示"超级管理员"
- ✅ localStorage中存储了token

**验证方法：**
```javascript
// 在浏览器控制台执行
localStorage.getItem('token')
// 应该返回JWT token字符串
```

### 2.2 自动登录测试

**测试步骤：**
1. 登录成功后
2. 刷新页面（F5）

**预期结果：**
- ✅ 保持登录状态
- ✅ 不会跳转到登录页面
- ✅ 用户信息正常显示

### 2.3 退出登录测试

**测试步骤：**
1. 点击右上角用户名
2. 选择"退出登录"

**预期结果：**
- ✅ 显示"退出成功"提示
- ✅ 自动跳转到登录页面
- ✅ localStorage中的token被清除

---

## 3. 用户管理测试

### 3.1 查看用户列表

**测试步骤：**
1. 登录系统
2. 点击左侧菜单"用户管理"

**预期结果：**
- ✅ 显示用户列表表格
- ✅ 显示用户名、昵称、邮箱、手机号、状态、角色等信息
- ✅ 显示分页组件
- ✅ 显示搜索框和筛选下拉框

### 3.2 搜索用户

**测试步骤：**
1. 在搜索框输入关键词（如"admin"）
2. 点击"搜索"按钮或按Enter键

**预期结果：**
- ✅ 列表刷新，只显示匹配的用户
- ✅ 显示加载状态
- ✅ 分页信息更新

### 3.3 筛选用户

**测试步骤：**
1. 点击"状态"下拉框
2. 选择"正常"

**预期结果：**
- ✅ 列表刷新，只显示状态为ACTIVE的用户
- ✅ 分页信息更新

### 3.4 新增用户

**测试步骤：**
1. 点击"新增用户"按钮
2. 填写表单：
   - 用户名：testuser
   - 邮箱：test@example.com
   - 手机号：13800138000
   - 密码：password123
   - 昵称：测试用户
   - 状态：正常
   - 角色：编辑者
3. 点击"确定"按钮

**预期结果：**
- ✅ 显示"创建成功"提示
- ✅ 对话框关闭
- ✅ 用户列表刷新，新用户出现在列表中

**表单验证测试：**
- 用户名为空 → 显示"请输入用户名"
- 用户名少于3个字符 → 显示"用户名长度在3-50之间"
- 邮箱格式错误 → 显示"请输入正确的邮箱格式"
- 密码为空 → 显示"请输入密码"
- 密码少于6个字符 → 显示"密码长度在6-20之间"
- 手机号格式错误 → 显示"请输入正确的手机号"

### 3.5 编辑用户

**测试步骤：**
1. 点击某个用户的"编辑"按钮
2. 修改昵称为"测试用户2"
3. 点击"确定"按钮

**预期结果：**
- ✅ 显示"更新成功"提示
- ✅ 对话框关闭
- ✅ 用户列表刷新，昵称已更新

**注意：**
- 编辑时用户名字段应该是禁用状态
- 不需要输入密码

### 3.6 删除用户

**测试步骤：**
1. 点击某个用户的"删除"按钮
2. 在确认对话框中点击"确定"

**预期结果：**
- ✅ 显示确认对话框："确定要删除用户 "xxx" 吗？"
- ✅ 点击确定后显示"删除成功"提示
- ✅ 用户列表刷新，该用户不再显示

**取消删除测试：**
1. 点击"删除"按钮
2. 在确认对话框中点击"取消"
3. 对话框关闭，用户未被删除

### 3.7 分页测试

**测试步骤：**
1. 点击分页组件的"下一页"
2. 修改每页显示数量为20

**预期结果：**
- ✅ 列表刷新，显示下一页数据
- ✅ 当前页码更新
- ✅ 修改每页数量后，列表刷新

---

## 4. API测试

### 4.1 使用Swagger测试

**访问Swagger：**
http://localhost:8080/api/swagger-ui.html

**测试步骤：**
1. 找到"auth-controller"
2. 展开"POST /auth/login"
3. 点击"Try it out"
4. 输入请求体：
```json
{
  "username": "admin",
  "password": "password"
}
```
5. 点击"Execute"

**预期结果：**
- 响应码：200
- 响应体包含token和用户信息

### 4.2 使用PowerShell测试

**登录并获取token：**
```powershell
$body = '{"username":"admin","password":"password"}'
$response = Invoke-WebRequest -Uri http://localhost:8080/api/auth/login -Method POST -Body $body -ContentType "application/json"
$result = $response.Content | ConvertFrom-Json
$token = $result.data.token
Write-Host "Token: $token"
```

**获取用户列表：**
```powershell
$headers = @{Authorization="Bearer $token"}
$response = Invoke-WebRequest -Uri "http://localhost:8080/api/users?page=1&size=10" -Headers $headers
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

**获取用户详情：**
```powershell
$response = Invoke-WebRequest -Uri "http://localhost:8080/api/users/1" -Headers $headers
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

**创建用户：**
```powershell
$newUser = @{
    username = "testuser2"
    email = "test2@example.com"
    password = "password123"
    nickname = "测试用户2"
    status = "ACTIVE"
    roleIds = @(3)
} | ConvertTo-Json

$response = Invoke-WebRequest -Uri "http://localhost:8080/api/users" -Method POST -Headers $headers -Body $newUser -ContentType "application/json"
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

**更新用户：**
```powershell
$updateUser = @{
    nickname = "测试用户2-更新"
    status = "ACTIVE"
} | ConvertTo-Json

$response = Invoke-WebRequest -Uri "http://localhost:8080/api/users/27" -Method PUT -Headers $headers -Body $updateUser -ContentType "application/json"
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

**删除用户：**
```powershell
$response = Invoke-WebRequest -Uri "http://localhost:8080/api/users/27" -Method DELETE -Headers $headers
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10
```

---

## 5. 常见问题

### 5.1 登录失败

**问题：** 输入正确的用户名和密码，但登录失败

**解决方案：**
1. 确认密码是`password`，不是`admin123`
2. 检查后端服务是否正常运行
3. 查看浏览器控制台错误信息
4. 查看后端日志

### 5.2 页面空白

**问题：** 访问前端页面显示空白

**解决方案：**
1. 清除浏览器缓存（Ctrl + Shift + Delete）
2. 硬性重新加载（Ctrl + Shift + R）
3. 使用无痕模式访问
4. 检查前端服务是否正常运行

### 5.3 API调用失败

**问题：** 前端调用API返回401或403错误

**解决方案：**
1. 检查token是否存在：`localStorage.getItem('token')`
2. 检查token是否过期（7天有效期）
3. 重新登录获取新token
4. 检查用户是否有相应权限

### 5.4 创建用户失败

**问题：** 创建用户时提示"用户名已存在"或"邮箱已存在"

**解决方案：**
1. 使用不同的用户名和邮箱
2. 检查数据库中是否已存在该用户
3. 如果是测试数据，可以先删除再创建

### 5.5 分页不正常

**问题：** 点击分页按钮，列表不刷新

**解决方案：**
1. 检查浏览器控制台错误
2. 检查Network标签中的API请求
3. 确认后端API返回正确的分页数据

---

## 6. 测试检查清单

### 6.1 用户认证

- [ ] 登录成功
- [ ] 登录失败（错误密码）
- [ ] 自动登录
- [ ] 退出登录
- [ ] Token过期处理

### 6.2 用户管理

- [ ] 查看用户列表
- [ ] 搜索用户
- [ ] 筛选用户（按状态）
- [ ] 新增用户
- [ ] 编辑用户
- [ ] 删除用户
- [ ] 分页功能
- [ ] 表单验证

### 6.3 API测试

- [ ] POST /api/auth/login
- [ ] GET /api/auth/me
- [ ] POST /api/auth/logout
- [ ] GET /api/users
- [ ] GET /api/users/{id}
- [ ] POST /api/users
- [ ] PUT /api/users/{id}
- [ ] DELETE /api/users/{id}

---

## 7. 性能测试

### 7.1 响应时间

- 登录接口：< 500ms
- 用户列表接口：< 1000ms
- 创建用户接口：< 500ms

### 7.2 并发测试

使用JMeter或Postman进行并发测试：
- 100个并发用户登录
- 50个并发用户查询列表

---

## 8. 安全测试

### 8.1 认证测试

- [ ] 未登录访问受保护接口 → 返回401
- [ ] Token过期访问 → 返回401
- [ ] 无效Token访问 → 返回401

### 8.2 权限测试

- [ ] 普通用户访问管理员接口 → 返回403
- [ ] 编辑者创建用户 → 返回403

### 8.3 输入验证

- [ ] SQL注入测试
- [ ] XSS攻击测试
- [ ] 特殊字符测试

---

**测试完成后，请将结果记录在测试报告中！**

